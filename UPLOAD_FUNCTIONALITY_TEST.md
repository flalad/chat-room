# 文件上传功能测试指南

## 测试前准备

1. 确保数据库连接正常
2. 启动聊天室应用
3. 登录用户账户

## 测试项目

### 1. 上传按钮测试
- [ ] 点击聊天输入框左侧的📎按钮
- [ ] 应该弹出"选择文件上传方式"模态框
- [ ] 模态框显示"数据库存储"和"S3云存储"选项
- [ ] 点击"数据库存储"应该打开文件选择器

### 2. 粘贴上传测试
- [ ] 复制一张图片到剪贴板
- [ ] 在聊天输入框中按 Ctrl+V
- [ ] 应该显示"检测到 1 个文件，正在处理..."提示
- [ ] 应该弹出存储方式选择对话框

### 3. 拖拽上传测试
- [ ] 将文件拖拽到聊天消息区域
- [ ] 应该显示拖拽高亮效果
- [ ] 松开鼠标应该弹出存储方式选择对话框

### 4. 文件类型测试
- [ ] 上传图片文件（JPG, PNG, GIF）
- [ ] 上传文档文件（PDF, DOC, TXT）
- [ ] 上传音频文件（MP3, WAV）
- [ ] 上传视频文件（MP4, WebM）
- [ ] 测试不支持的文件类型（应显示错误）

### 5. 文件大小测试
- [ ] 上传小于10MB的文件（应推荐数据库存储）
- [ ] 上传大于10MB的文件（应只能选择S3存储）
- [ ] 上传大于50MB的文件（应显示错误）

### 6. 存储方式测试
- [ ] 选择数据库存储，文件应正常上传
- [ ] 选择S3存储（如果已配置），文件应正常上传
- [ ] 上传的文件消息应显示存储类型标识（🗄️ 或 ☁️）

### 7. 文件显示测试
- [ ] 图片文件应显示预览图
- [ ] 视频文件应显示播放器
- [ ] 音频文件应显示播放控件
- [ ] 其他文件应显示文件图标和下载按钮

### 8. 下载测试
- [ ] 点击文件的下载按钮
- [ ] 文件应在新标签页中打开或下载
- [ ] 数据库存储的文件URL格式：`/api/files/db/{fileId}`
- [ ] S3存储的文件URL格式：S3的完整URL

## 故障排除

### 上传按钮无反应
1. 检查浏览器控制台是否有JavaScript错误
2. 确认 `enhancedFileUploadManager` 已正确初始化
3. 检查用户是否已登录

### 粘贴功能不工作
1. 确认浏览器支持剪贴板API
2. 检查是否在正确的元素上触发粘贴事件
3. 确认粘贴的内容包含文件数据

### 文件上传失败
1. 检查网络连接
2. 查看服务器日志中的错误信息
3. 确认数据库连接正常
4. 检查文件大小和类型限制

### 文件无法显示
1. 确认文件URL可访问
2. 检查文件MIME类型是否正确
3. 查看浏览器网络面板中的请求状态

## 预期行为

### 成功上传流程
1. 用户选择文件 → 显示存储选择对话框
2. 选择存储方式 → 显示上传进度
3. 上传完成 → 在聊天中显示文件消息
4. 文件消息包含预览（如果适用）和下载链接

### 错误处理
1. 文件过大 → 显示错误提示
2. 文件类型不支持 → 显示错误提示
3. 网络错误 → 显示重试选项
4. 存储服务未配置 → 显示配置提示

## 性能指标

- 小文件（<1MB）上传时间：< 3秒
- 中等文件（1-10MB）上传时间：< 10秒
- 图片预览加载时间：< 1秒
- 文件下载响应时间：< 2秒

## 浏览器兼容性

测试以下浏览器：
- [ ] Chrome 90+
- [ ] Firefox 88+
- [ ] Safari 14+
- [ ] Edge 90+

## 移动设备测试

- [ ] 触摸选择文件
- [ ] 相机拍照上传
- [ ] 图片库选择
- [ ] 文件管理器选择